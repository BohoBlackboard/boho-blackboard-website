<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thank You | Boho Blackboard</title>

  <link rel="icon" type="image/png" href="bb favicon.png">
  <link rel="stylesheet" href="style.css">

  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

  <script>
    emailjs.init("_RstzO3AfSZ0UV3y7");
  </script>
</head>

<body>

<header>
  <h1 class="logo">Boho Blackboard</h1>
  <div class="swoosh"></div>
</header>

<section class="sub-banner">
  <img src="banner.png" alt="Success Banner">
</section>

<main class="content" style="text-align:center;">
  <h2>Thank You for Your Purchase!</h2>
  <p>Your download links are being emailed to you now.</p>

  <h3 id="status" style="margin-top:20px; color:#444;"></h3>
</main>

<footer>
  © 2025 Boho Blackboard | Designed from the heart by Danielle Droste
</footer>

<script>
console.log("SUCCESS PAGE LOADED");

const params = new URLSearchParams(window.location.search);

const customerEmail = params.get("email");
const cartJSON = params.get("custom_str1");

let cart = [];
try {
  if (cartJSON) cart = JSON.parse(decodeURIComponent(cartJSON));
} catch (err) {
  console.error("JSON parse error:", err);
}

console.log("EMAIL:", customerEmail);
console.log("CART:", cart);

// Download links:
const downloadLinks = {
  "Boho-Dachshunds": "downloads/boho-dachshunds.zip",
  "Boho-Dachshunds-Afrikaans": "downloads/boho-dachshunds-afrikaans.zip",
  "Boho-Owls": "downloads/boho-owls.zip",
  "Boho-Owls-Afrikaans": "downloads/boho-owls-afrikaans.zip"
};

let messageLinks = "";

cart.forEach(item => {
  if (downloadLinks[item.name]) {
    messageLinks += `${item.name}: https://bohoblackboard.github.io/boho/${downloadLinks[item.name]}\n`;
  }
});

// Send email
if (customerEmail && messageLinks) {

  emailjs.send("service_96euu0a", "template_wxt1tto", {
    customer_email: customerEmail,
    product_name: "Your Boho Blackboard Downloads",
    download_link: messageLinks
  })
  .then(() => {
    document.getElementById("status").innerText =
      "Your download email has been sent successfully! ❤️";
  })
  .catch(err => {
    console.error("EmailJS Error:", err);
    document.getElementById("status").innerText =
      "There was a problem sending your email. Please contact support.";
  });

} else {
  document.getElementById("status").innerText =
    "We could not generate your download email. Please contact support.";
}
</script>

</body>
</html>
